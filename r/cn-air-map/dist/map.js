!function t(o,n,e){function r(a,c){if(!n[a]){if(!o[a]){var l="function"==typeof require&&require;if(!c&&l)return l(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var s=n[a]={exports:{}};o[a][0].call(s.exports,function(t){var n=o[a][1][t];return r(n||t)},s,s.exports,t,o,n,e)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<e.length;a++)r(e[a]);return r}({1:[function(t,o,n){!function(){function o(t,o){for(var e in t)if("updateTime"!==e){var r,i=n(t[e]["PM2.5"]);r="yellow"==i.color?u:"brown"==i.color?p:L.AwesomeMarkers.icon({prefix:"fa",icon:"map-marker",markerColor:i.color});var a=o[e];L.marker([a.lat,a.lng],{icon:r,opacity:.9}).addTo(l).bindPopup("<strong>城市："+t[e].city+'</strong><br/><span class="'+i.color+'">PM2.5 空污指標：'+i.disc+"</span><br/><strong>AQI空氣指數類別："+t[e].quality+"</strong><br/>PM2.5："+t[e]["PM2.5"]+"（μg/m3）<br/>PM10："+t[e].PM10+'（μg/m3）<br/><a href="http://zh.wikipedia.org/wiki/%E7%A9%BA%E6%B0%94%E8%B4%A8%E9%87%8F%E6%8C%87%E6%95%B0">AQI</a>：'+t[e].AQI)}else $(".updateAt").text("更新時間："+t.updateTime.substring(0,16)+"（每1-2小時更新）");d3Initialize(l,o)}function n(t){return t<=12?{disc:"空氣品質良好",color:"green"}:t<=35?{disc:"空氣品質普通",color:"yellow"}:t<=55?{disc:"對敏感性族群不健康",color:"orange"}:t<=150?{disc:"空氣品質不良",color:"red"}:t<=250?{disc:"空氣品質非常不良",color:"purple"}:{disc:"空氣品質屬有害",color:"brown"}}function e(){l=new L.Map("map"),url="http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png",attrib='&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';var t=new L.TileLayer(url,{minZoom:1,maxZoom:16,attribution:attrib});l.setView(new L.LatLng(37.915624,110.220865),4),t.addTo(l),d.addTo(l),f.addTo(l)}function r(){if(navigator.geolocation)return navigator.geolocation.getCurrentPosition(i)}function i(t){l.setView(new L.LatLng(t.coords.latitude,t.coords.longitude),10)}function a(){l.setView(new L.LatLng(37.915624,110.220865),4)}function c(){s?$(".main-info").hide():$(".main-info").show(),s=!s}d3Initialize=t("./index");var l,s,d=L.control();window.getLocation=r,window.resetView=a,window.toogleInfo=c;var u=L.icon({iconUrl:"./images/yellow.png",iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[0,-35]}),p=L.icon({iconUrl:"./images/brown.png",iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[0,-35]});$(document).ready(function(){e(),d3.json("./data/location.json",function(t){d3.json("./data/data.json",function(n){o(n,t)})})}),d.onAdd=function(t){return this._div=L.DomUtil.create("div","info"),this._div.innerHTML='<h4 class="">格狀區塊：表示該區域內最近的測站</h4>',this._div};var f=L.control({position:"bottomright"});f.onAdd=function(t){for(var o=L.DomUtil.create("div","info legend"),n=["#5F2828","#E062C8","#F52305","#F7931C","yellow","#7FB73A"],e=["有害","非常不良","不良","接近不良","普通","良好"],r=0;r<e.length;r++)o.innerHTML+='<i style="background:'+n[r]+'"></i>'+e[r]+"<br/>";return o}}()},{"./index":2}],2:[function(t,o,n){!function(){function t(t,o){c=t,d=o,n(),t.on("viewreset moveend",function(t){t&&"viewreset"==t.type&&d3.select("#overlay").remove(),setTimeout(function(){n()},0)})}function n(){d3.select("#overlay").remove(),l=c.getBounds();var t=c.latLngToLayerPoint(l.getNorthWest());c.latLngToLayerPoint(l.getSouthEast()),d3.set(),l.pad(.4);i=d3.geo.mercator().center([122.079531,23.978567]).scale(10200),a=d3.geo.path().projection(i),r=d3.select(c.getPanes().overlayPane).append("svg").attr("id","overlay").attr("class","leaflet-zoom-hide").style("width",c.getSize().x+"px").style("height",c.getSize().y+"px").style("margin-left",t.x+"px").style("margin-top",t.y+"px"),s=r.append("g").attr("transform","translate("+-t.x+","+-t.y+")"),e()}function e(){var t=[];for(var o in d){var n=new L.LatLng(+d[o].lat,+d[o].lng);point=c.latLngToLayerPoint(n),t.push(point)}var e=s.attr("class","points").selectAll("g").data(t).enter().append("g").attr("class","point"),r=d3.geom.voronoi().x(function(t){return t.x}).y(function(t){return t.y});r(t).forEach(function(t){t.point.cell=t});var i=function(t){if(t.cell)return"M"+t.cell.join("L")+"Z";r([t]).forEach(function(t){return"M"+t.join("L")+"Z"})};e.append("path").attr("class","point-cell").on("click",u).attr("d",i)}o.exports=t;var r,i,a,c,l,s,d=null,u=function(){d3.selectAll(".selected").classed("selected",!1);var t=d3.select(this),o=t.datum();lastSelectedPoint=o,t.classed("selected",!0)}}()},{}]},{},[1]);